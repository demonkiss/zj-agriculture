<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
    <title>Cluster</title>
  
    <link href="Javascript/ArcGISAPI/3.16/dijit/themes/tundra/tundra.css" rel="stylesheet" />
    <!--<link rel="stylesheet" href="https://js.arcgis.com/3.20/esri/css/esri.css">-->
    <link href="Javascript/ArcGISAPI/3.16/esri/css/esri.css" rel="stylesheet" />
    <link href="css/base.css" rel="stylesheet" />
    <link href="css/gisframe.css" rel="stylesheet" />
    <!--<link href="css/layout.css" rel="stylesheet" />-->
    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            margin: 0;
            padding: 0;
        }

        /* center the image in the popup */
        .esriViewPopup .gallery {
            margin: 0 auto !important;
        }
    </style>

    <script>
        // helpful for understanding dojoConfig.packages vs. dojoConfig.paths:
        // http://www.sitepen.com/blog/2013/06/20/dojo-faq-what-is-the-difference-packages-vs-paths-vs-aliases/
        //var dojoConfig = {
        //    paths: {
        //        extras: location.pathname.replace(/\/[^/]+$/, "") + "/extras"
        //    }
        //};
        var selfUrl = document.location.href.substring(0, document.location.href.lastIndexOf("/"));
        console.log(selfUrl);
        dojoConfig = {
            parseOnLoad: true,
            baseUrl: "Javascript/ArcGISAPI/3.16/dojo",
            packages: [
        {
            name: 'mapconfig',
            location: selfUrl + "/Javascript/config",
            main: "config"

        }, {
            name: 'extras',
            location: selfUrl + "/extras",
            main: "extras"

        }
            ]
        }
    </script>
    <!--<script src="https://js.arcgis.com/3.20/"></script>-->
    <script src="Javascript/lib/jquery-2.1.4.js"></script>

    <script src="Javascript/ArcGISAPI/3.16/init.js"></script>
    <script>
        var map;
        var showClusterData;
        var clusterType = [];
        require([
          "dojo/parser",
          "dojo/ready",
          "dojo/_base/array",
          "esri/Color",
          "dojo/dom-style",
          "dojo/query",

          "esri/map",
          "esri/request",
          "esri/graphic",
          "esri/geometry/Extent",

          "esri/symbols/SimpleMarkerSymbol",
          "esri/symbols/SimpleFillSymbol",
          "esri/symbols/PictureMarkerSymbol",
          "esri/renderers/ClassBreaksRenderer",

          "esri/layers/GraphicsLayer",
          "esri/SpatialReference",
          "esri/dijit/PopupTemplate",
          "esri/geometry/Point",
          "esri/geometry/webMercatorUtils",
          "TDTLayer2",
          "TDTLayer_Anno",
          "extras/ClusterLayer",
          "extras/ClusterLayer_M",
          "dojo/on",
          "dojo/dom-class", "dojo/dom-style",
          "dijit/layout/BorderContainer",
          "dijit/layout/ContentPane",
          "dojo/domReady!"
        ], function (
          parser, ready, arrayUtils, Color, domStyle, query,
          Map, esriRequest, Graphic, Extent,
          SimpleMarkerSymbol, SimpleFillSymbol, PictureMarkerSymbol, ClassBreaksRenderer,
          GraphicsLayer, SpatialReference, PopupTemplate, Point, webMercatorUtils, TDTLayer,TDTLayer_Anno,
          ClusterLayer, ClusterLayer_M, on, domClass, domStyle
        ) {
            //ready(function () {
            //   parser.parse();
            //清除arcgis/rest/info?=json问题
            esri.config.defaults.io.corsDetection = false;
            var clusterLayer;
            var popupOptions = {
                "markerSymbol": new SimpleMarkerSymbol("circle", 20, null, new Color([0, 0, 0, 0.25])),
                "marginLeft": "20",
                "marginTop": "20"
            };
            var initextent = new Extent(120.135361472, 30.2208220636, 120.185361472, 30.2708220636, new SpatialReference({ wkid: 4326 }));
            var fullExtent = new Extent(118.33968849655, 29.1885894750343, 120.75238251614, 30.6257261531396, new SpatialReference({ "wkid": 4326 }));
            map = new Map("map", {
                  // basemap: "topo",
                logo: false,
                slider: false,
                extent: fullExtent,
             //   center: [119.789, 29.543],
              //  zoom: 9
            });
            var layer = new TDTLayer("img");//影像img 矢量 vec
             map.addLayer(layer, 0);
            var annolayer = new TDTLayer_Anno("cia");//影像cia 矢量cva
           map.addLayer(annolayer, 1);
            var updateListener = map.on("update-end", function (err) {
                // do something
               // alert(1);
                $.ajax({
                    url: "Json/ls.json",
                    dataType: 'json',
                    type: "GET",
                    async: true,
                    data: {},
                    success: function (data) {
                        // pointData = data;
                        showClusterData = data.features;
                      //  addClusters(data);

                    }

                });
                //$.ajax({
                //    url: "Json/multiType.json",
                //    dataType: 'json',
                //    type: "GET",
                //    async: true,
                //    data: {},
                //    success: function (data) {
                //        pointData = data;
                //        addMultiClusters(data);

                //    }

                //});
                updateListener.remove();
            });
            var basemap = "http://www.hangzhoumap.gov.cn/a67db68dbfb2752f9b913dff9ece867117c87e95/Tile/ArcGISFlex/HZTDTVECTORBLEND.gis";
           //   var basemap = "http://www.hangzhoumap.gov.cn/Tile/ArcGISFlex/HZTDTVECTORBLEND.gis";
            // var basemap = "http://21.15.121.121/a67db68dbfb2752f9b913dff9ece867117c87e95/Tile/ArcGISREST/HZSYVECTOR201512wkid.gis";
            //  var basemap = "http://126.11.9.43:7080/PBS/rest/services/TianDiTuAnnotation/MapServer";
            basemap = new esri.layers.ArcGISTiledMapServiceLayer(basemap, { id: "basemap" });
           // map.addLayer(basemap, 2);
            $(function () {
                //数组方法的扩展
                Array.prototype.indexOf = function (val) {
                    for (var i = 0; i < this.length; i++) {
                        if (this[i] === val) return i;
                    }
                    return -1;
                };
                Array.prototype.remove = function (val) {
                    var index = this.indexOf(val);
                    if (index > -1) {
                        this.splice(index, 1);
                    }
                };
                bindEvt();
            })
            
        
          
            //map.on("load", function () {
            //  //  alert(2);
            //    $.ajax({
            //        url: "Json/20000json.json",
            //        dataType: 'json',
            //        type: "GET",
            //        async: true,
            //        data: {},
            //        success: function (data) {
            //            pointData = data;
            //            addClusters(data);

            //        }

            //    });
            //})
            function bindEvt() {
                //给label绑定点击选中事件
                $(".checks").find("label").each(function () {
                    $(this).on("click", function () {
                        if ($(this).attr("data-state") == "uncheck") {
                            $(this).attr("data-state", "check");
                            $(this).addClass("active");
                            
                            // $('#left').children(':visible');
                            clusterType.push($(this).next().text());
                            console.log(clusterType);
                          

                        } else {
                            $(this).attr("data-state", "uncheck");
                            $(this).removeClass("active");
                            clusterType.remove($(this).next().text());
                            console.log(clusterType);
                        }
                        $(this).prev().trigger("click");
                    })
                });
                //切换选择部分的js
                $(".btns").on("click", "li", function () {
                    clusterType.length = 0;
                    $(this).addClass("active").siblings().removeClass("active");
                    var $index = $(this).index();
                    $(".content .control").find("ul.second").eq($index).show().siblings("ul.second").hide();
                    $(".control").find("ul.second").eq($index).find("li").eq(0).trigger("click");

                   // alert(2);
                    var types = $(this).parent().children("label");
                    for (var i = 0; i < types.length; i++) {

                        if (types[i].attr("data-state") == "checked") {
                            clusterType.push($(this).next().text());
                        }

                    }

                });
                $(".control").find(".second").each(function () {
                    $(this).on("click", "li", function () {
                        clusterType.length = 0;
                        $(this).addClass("active").siblings().removeClass("active");
                        var $clazz = $(this).attr("class");
                        $clazz = $clazz.split(" ");
                        $clazz.map(function (item) {
                            if (item != "active") {
                                $(".checks").find("." + $clazz).show().siblings("ul").hide();
                            }
                        })
                    })
                });
                $("#function").click(function () {
                   // $(".content").show();
                    $("#farmArea").show();
                    $("#cityArea").hide();
                    $(".content>img").click(function () {
                        $(".content").hide();
                    })
                })
                $("#proSelect").on("change", function () {
                    console.log($(this).find("option:checked").text());
                    var proName = $(this).find("option:checked").text();
                    $("#cityArea").show();
                    // $(".content").show();
                    getsubArea("zj");
                    $("#farmArea").hide();
                    $(".content>img").click(function () {
                        $(".content").hide();
                    })
                })
                //checkbox
                //$('.checks input:checkbox').click(function () {
                //    this.blur();
                //    this.focus();
                //    $(this).text();
                //    console.log($(this).parent().children("input"));
                //});
               
                //切换底图
                var MapMenu = dojo.query(".MapMenu a");
                on(MapMenu[0], "click", function (e) {
                    //  filterReset();
                    domClass.remove(MapMenu[1], "Mapsatellite1");
                    domClass.add(MapMenu[1], "Mapsatellite");
                    domClass.add(MapMenu[0], "Mapmap1");
                    showLayer("VECTOR");

                });
                on(MapMenu[1], "click", function (e) {
                    //  filterReset();
                    domClass.remove(MapMenu[0], "Mapmap1");
                    domClass.add(MapMenu[0], "Mapmap");
                    domClass.add(MapMenu[1], "Mapsatellite1");
                    showLayer("RASTER");

                });
                //市点击事件
                $("#cityArea .control").on("click", ".sj", "", clickSArea);
                //县级事件
                $("#cityArea .control").on("click", ".xj", "", clickArea);
            }
            function getsubArea(i) {
              //  ResetLayer();
                var areaId = i;

                if (map != undefined && areaId == "") {
                    map.centerAndZoom([120.19, 30.26], 8);
                }

                if (areaId == "zj") {
                  //  document.getElementById("areaName").innerHTML = "浙江省";
                   // document.getElementById("areaNum").innerHTML = "";
                    var htm = "";
                    $.ajax({//生成各市级
                        url: 'Json/area.xml',
                        dataType: 'xml',
                        success: function (data) {

                            $(data).find("root").find("sjzone").each(function (index, ele) {
                                var id = $(ele).attr("id");
                                var value = $(ele).attr("value");
                                var name = $(ele).attr("name");


                                htm += "<span bh="+ id+" class='pt sj' id='std" + (index + 1) + "'>" + name + "</span>";
                            })
                            $("#cityArea .control").empty();
                            $("#cityArea .control").append(htm);

                        }
                    })
                    //var htm = "";

                    //htm += "<span onclick='clickSArea(3302);' class='pt' id='std" + 2 + "'>宁波市(<em id='areaNum3302'>0</em>)</span>";
                    //htm += "<span onclick='clickSArea(3303);' class='pt' id='std" + 3 + "'>温州市(<em id='areaNum3303'>0</em>)</span>";
                    //htm += "<span onclick='clickSArea(3304);' class='pt' id='std" + 4 + "'>嘉兴市(<em id='areaNum3304'>0</em>)</span>";
                    //htm += "<span onclick='clickSArea(3305);' class='pt' id='std" + 5 + "'>湖州市(<em id='areaNum3305'>0</em>)</span>";
                    //htm += "<span onclick='clickSArea(3306);' class='pt' id='std" + 6 + "'>绍兴市(<em id='areaNum3306'>0</em>)</span>";
                    //htm += "<span onclick='clickSArea(3307);' class='pt' id='std" + 7 + "'>金华市(<em id='areaNum3307'>27179</em>)</span>";
                    //htm += "<span onclick='clickSArea(3308);' class='pt' id='std" + 8 + "'>衢州市(<em id='areaNum3308'>0</em>)</span>";
                    //htm += "<span onclick='clickSArea(3309);' class='pt' id='std" + 9 + "'>舟山市(<em id='areaNum3309'>0</em>)</span>";
                    //htm += "<span onclick='clickSArea(3310);' class='pt' id='std" + 10 + "'>台州市(<em id='areaNum3310'>0</em>)</span>";
                    //htm += "<span onclick='clickSArea(3311);' class='pt' id='std" + 11 + "'>丽水市(<em id='areaNum3311'>0</em>)</span>";


                } else {

                    $.ajax({//生成各县级
                        url: 'Json/area.xml',
                        dataType: 'xml',
                        success: function (data) {
                            var html = "";
                            $(data).find("root").find("sjzone").each(function (index, ele) {
                                var id = $(ele).attr("id");
                                if (areaId == id) {
                                    var lat = Number($(ele).attr("lat"));
                                    var lng = Number($(ele).attr("lng"));

                                    if (map != undefined) {
                                        map.centerAndZoom([lat, lng], 8);
                                    }
                                    $(ele).find("xjzone").each(function (indexx, elex) {
                                        var xjid = $(elex).attr("id");
                                        var xjName = $(elex).attr("name");
                                        var xjLat = $(elex).attr("lat");
                                        var xjLng = $(elex).attr("lng");
                                        var hasXjvalue = $(elex).attr("value");
                                        var url = $(elex).attr("url");
                                        var layerindex;
                                        if ($(elex).attr("layerindex") != "") {
                                            layerindex = $(elex).attr("layerindex");
                                        } else {
                                            layerindex = 0;
                                        }
                                        var xjvalue = 0;
                                        if (hasXjvalue) {
                                            xjvalue = hasXjvalue;
                                        }
                                      //  html += "<span onclick='clickArea(" + xjid + ",\"" + xjName + "\"," + xjLat + "," + xjLng + "," + layerindex + ",\"" + url + "\");' class='pt' id='xjtd" + xjid + "'>" + xjName + "(<em id='areaNum" + xjid + "'>" + xjvalue + "</em>)</span>";
                                        html += "<span xjid=" + xjid + " xjName=" + xjName + " xjLat=" + xjLat + " xjLng=" + xjLng + " class='pt xj' id='xjtd" + xjid + "'>" + xjName + "</span>";
                                    });
                                }
                            });

                           $("#cityArea .control").empty();
                           $("#cityArea .control").append(html);
                        }
                    });
                }

               // var sjname = $('#areaId option:selected').text();
             //   var sjid = $('#areaId option:selected').val() + "00";
                // showSjBorder(sjid, sjname);
                //   getCityChart(sjname);
                //计算数量
                //getNumsByAreaCode();
                //if (map != undefined) {
                //    loadGetPointData();
                //}
            }
            //各区点击事件
            function clickSArea(i) {
               // onclick = 'clickSArea(" + id + ")'
               // $("#areaId").val(i);
                // ResetLayer();
                
                getsubArea($(this).attr("bh"));

            }
            //各县点击事件
            function clickArea(xjid, xjname, lat, lng, layerindex, url) {
              //  currentLayerServiceUrl = url;
                //  currentLayerIndex = [layerindex];
                var xjid = $(this).attr("xjid");
                var xjname = $(this).attr("xjname");
                var lat = $$(this).attr("xjlat");
                var lna = $$(this).attr("xjlna");

                if (map != undefined) {
                    map.centerAndZoom([lat, lng], 11);
                    //sj_layer.setVisibleLayers([layerindex]);
                }
            
                //如果按下的pt
                if ($("#xjtd" + xjid).attr("class") == "pt") {
                    $(".ptdown").each(function (index, ele) {
                        $(ele).removeClass();
                        $(ele).addClass("pt");
                    });
                    $("#xjtd" + xjid).removeClass();
                    $("#xjtd" + xjid).addClass("ptdown");
                } else {
                    $("#xjtd" + xjid).removeClass();
                    $("#xjtd" + xjid).addClass("pt");
                }
                var fileid = xjid.toString().substring(0, 4) + "00";
                //  showXjBorder(fileid, xjname);显示县级边界
                // loadGetPointData(xjid);
                console.log(fileid);
            }
            function addMultiClusters(multiData) {
                var point_array = [];
                var wgs = new esri.SpatialReference({
                    "wkid": 4326
                });
                for (var k = 0; k < multiData.length; k++) {
                    var photoInfo = {};
                    if (k == 0) {
                        type = "green";
                    } else {
                        type = "blue";
                    }
                    photoInfo.data = arrayUtils.map(multiData[k], function (p, i) {
                     //   var latlng = new Point(parseFloat(p.geometry.x), parseFloat(p.geometry.y), wgs);
                        //  var latlng = new Point(parseFloat(p.lng), parseFloat(p.lat), wgs);
                        var latlng = new Point(parseFloat(p.x), parseFloat(p.y), wgs);
                        var webMercator = webMercatorUtils.geographicToWebMercator(latlng);
                        
                        var attributes = {
                            "Area": "111",
                            "Name": p.name,
                            "Type":type

                        };
                        return {
                            "x": webMercator.x,
                            "y": webMercator.y,

                            "attributes": attributes
                        };
                    });
                    point_array.push(photoInfo.data);
                }
                

                // popupTemplate to work with attributes specific to this dataset
                var popupTemplate = new PopupTemplate({
                    "title": "",
                    "fieldInfos": [{
                        "fieldName": "index",
                        visible: true
                    }, {
                        "fieldName": "Name",
                        "label": "By",
                        visible: true
                    }, {
                        "fieldName": "Link",
                        "label": "On Instagram",
                        visible: true
                    }]
                });

                // cluster layer that uses OpenLayers style clustering
                clusterLayer = new ClusterLayer_M({
                    //  "data": photoInfo.data,
                    "data": point_array,
                    "distance": 100,
                    "id": "clusters",
                    "labelColor": "#000",
                    "labelOffset": 10,
                    "showSingles": true,
                    //  "resolution": map.extent.getWidth() / map.width,
                    "singleColor": "#888",
                    // "spatialReference" :new esri.SpatialReference({ "wkid": 4326 }),
                    "singleTemplate": popupTemplate,
                    "maxSingles": 5000
                });
                var defaultSym = new SimpleMarkerSymbol().setSize(4);
                var renderer = new ClassBreaksRenderer(defaultSym, "clusterCount");

                //var picBaseUrl = "https://static.arcgis.com/images/Symbols/Shapes/";
                //var blue = new PictureMarkerSymbol(picBaseUrl + "BluePin1LargeB.png", 100, 100).setOffset(0, 15);
                //var green = new PictureMarkerSymbol(picBaseUrl + "GreenPin1LargeB.png", 100, 100).setOffset(0, 15);
                //var red = new PictureMarkerSymbol(picBaseUrl + "RedPin1LargeB.png", 100, 100).setOffset(0, 15);
                var picBaseUrl = "img/";
                var blue = new PictureMarkerSymbol(picBaseUrl + "marker-blue.png", 28, 52).setOffset(0, 0);
                var green = new PictureMarkerSymbol(picBaseUrl + "marker-green.png", 28, 52).setOffset(0, 0);
                var red = new PictureMarkerSymbol(picBaseUrl + "marker-green.png", 28, 52).setOffset(0, 0);
              //  renderer.addBreak(0, 30000, blue);
                //    renderer.addBreak(100, 1000, green);
                //  renderer.addBreak(1000, 30000, red);

               // clusterLayer.setRenderer(renderer);
                map.addLayer(clusterLayer);

                // close the info window when the map is clicked
                map.on("click", cleanUp);
                // close the info window when esc is pressed
                map.on("key-down", function (e) {
                    if (e.keyCode === 27) {
                        cleanUp();
                    }
                });
            }
            function addClusters(resp) {
                var photoInfo = {};
                var wgs = new esri.SpatialReference({
                    "wkid": 4326
                });
            //    photoInfo.data = arrayUtils.map(resp, function (p) {
                    photoInfo.data = arrayUtils.map(resp.features, function (p, i) {
                        var latlng = new Point(parseFloat(p.geometry.x), parseFloat(p.geometry.y), wgs);
                    //  var latlng = new Point(parseFloat(p.lng), parseFloat(p.lat), wgs);
                  //  var latlng = new Point(parseFloat(p.X), parseFloat(p.Y), wgs);
                    var webMercator = webMercatorUtils.geographicToWebMercator(latlng);
                    var attributes = {
                        "index": "111",
                        "Name": p.NAME
                        //"Image": p.image,
                        //"Link": p.link
                    };
                    return {
                       "x": webMercator.x,
                        "y": webMercator.y,
                       // "x": latlng.x,
                     //   "y": latlng.y,
                        "attributes": attributes
                    };
                });

                // popupTemplate to work with attributes specific to this dataset
                var popupTemplate = new PopupTemplate({
                    "title": "",
                    "fieldInfos": [{
                        "fieldName": "index",
                        visible: true
                    }, {
                        "fieldName": "Name",
                        "label": "By",
                        visible: true
                    }, {
                        "fieldName": "Link",
                        "label": "On Instagram",
                        visible: true
                    }]
                });

                // cluster layer that uses OpenLayers style clustering
                 clusterLayer = new ClusterLayer({
                    "data": photoInfo.data,
                    "distance": 100,
                    "id": "clusters",
                    "labelColor": "#000",
                    "labelOffset": 10,
                    "showSingles": true,
                  //  "resolution": map.extent.getWidth() / map.width,
                    "singleColor": "#888",
                   // "spatialReference" :new esri.SpatialReference({ "wkid": 4326 }),
                    "singleTemplate": popupTemplate,
                    "maxSingles": 5000
                });
                var defaultSym = new SimpleMarkerSymbol().setSize(4);
                var renderer = new ClassBreaksRenderer(defaultSym, "clusterCount");

                //var picBaseUrl = "https://static.arcgis.com/images/Symbols/Shapes/";
                //var blue = new PictureMarkerSymbol(picBaseUrl + "BluePin1LargeB.png", 100, 100).setOffset(0, 15);
                //var green = new PictureMarkerSymbol(picBaseUrl + "GreenPin1LargeB.png", 100, 100).setOffset(0, 15);
                //var red = new PictureMarkerSymbol(picBaseUrl + "RedPin1LargeB.png", 100, 100).setOffset(0, 15);
                var picBaseUrl = "img/";
                var blue = new PictureMarkerSymbol(picBaseUrl + "marker-blue.png", 28, 52).setOffset(0, 0);
                var green = new PictureMarkerSymbol(picBaseUrl + "marker-green.png", 28, 52).setOffset(0, 0);
                var red = new PictureMarkerSymbol(picBaseUrl + "marker-green.png", 28, 52).setOffset(0, 0);
                renderer.addBreak(0, 30000, blue);
            //    renderer.addBreak(100, 1000, green);
              //  renderer.addBreak(1000, 30000, red);

                clusterLayer.setRenderer(renderer);
                map.addLayer(clusterLayer);

                // close the info window when the map is clicked
                map.on("click", cleanUp);
                // close the info window when esc is pressed
                map.on("key-down", function (e) {
                    if (e.keyCode === 27) {
                        cleanUp();
                    }
                });
            }
            //切换底图
            function showLayer(maptype) {
                require(["TDTLayer", "TDTLayer_Anno"], function (TDTLayer, TDTLayer_Anno) {
                    if (maptype == "VECTOR") {
                        if (map.layerIds.length > 0) {
                            var rmap = map.getLayer(map.layerIds[0]);
                            var rmap_anno = map.getLayer(map.layerIds[1]);
                            map.removeLayer(rmap);
                            map.removeLayer(rmap_anno);
                        }
                        var layer = new TDTLayer("vec");//影像img 矢量 vec
                        map.addLayer(layer, 0);
                        var annolayer = new TDTLayer_Anno("cva");//影像cia 矢量cva
                        map.addLayer(annolayer, 1);
                    }
                    else {
                        if (map.layerIds.length > 0) {
                            var rmap = map.getLayer(map.layerIds[0]);
                            var rmap_anno = map.getLayer(map.layerIds[1]);
                            map.removeLayer(rmap);
                            map.removeLayer(rmap_anno);
                        }
                        var layer = new TDTLayer("img");//影像img 矢量 vec
                        map.addLayer(layer, 0);
                        var annolayer = new TDTLayer_Anno("cia");//影像cia 矢量cva
                        map.addLayer(annolayer, 1);
                    }
                })
            }
            function cleanUp() {
                map.infoWindow.hide();
                clusterLayer.clearSingles();
            }

            function error(err) {
                console.log("something failed: ", err);
            }

            // show cluster extents...
            // never called directly but useful from the console
            //window.showExtents = function () {
            //    var extents = map.getLayer("clusterExtents");
            //    if (extents) {
            //        map.removeLayer(extents);
            //    }
            //    extents = new GraphicsLayer({ id: "clusterExtents" });
            //    var sym = new SimpleFillSymbol().setColor(new Color([205, 193, 197, 0.5]));

            //    arrayUtils.forEach(clusterLayer._clusters, function (c, idx) {
            //        var e = c.attributes.extent;
            //        extents.add(new Graphic(new Extent(e[0], e[1], e[2], e[3], map.spatialReference), sym));
            //    }, this);
            //    map.addLayer(extents, 0);
            //};
            // });
        });
    </script>
</head>

<body>
    <div class="left">
        <div class="top">
            <div class="fl">
                <input type="text" placeholder="输入关键词">
                <a href="javascript:void (0)" class="fr"><img src="images/search.png"></a>
            </div>
            <div class="fr">
                <select name="" id="proSelect" class="province">
                    <option value="">浙江</option>
                    <option value="">安徽</option>
                    <option value="">北京</option>
                </select>
                <img src="images/select.png">
                <span>450个</span>
                <span class="function" id="function">功能<img src="images/function.png"></span>
            </div>
        </div>
        <div id="farmArea" class="content" style="display: none">
            <img src="images/close.png" class="fr">
            <div class="control">
                <ul class="btns">
                    <li class="ls active">粮食生产功能区</li>
                    <li class="yq">现代农业园区</li>
                    <li class="nt">标准农田</li>
                </ul>
                <ul class="second ls-content" style="display: block">
                    <li class="active gn">功能区级别</li>
                    <li class="zt">建设状态</li>
                    <li class="mj">建设面积</li>
                    <li class="nf">建设年份</li>
                </ul>
                <ul class="second yq-content" style="display: none">
                    <li class="xdny">现代农业综合区</li>
                    <li class="zdcy">主导产业示范区</li>
                    <li class="tsny">特色农业精品区</li>
                </ul>
                <ul class="second nt-content" style="display: none">
                    <li class="cgxm">千万亩工程项目</li>
                    <li class="bznt">标准农田建设区</li>
                    <li class="cbxm">储备项目</li>
                    <li class="tsgc">提升工程</li>
                </ul>
            </div>
            <div class="checks">
                <ul class="gn" style="display: block">
                    <li>
                        <ul>
                            <li>
                                <img src="images/province.png">
                                <input type="checkbox" id="1">
                                <label for="1" data-state="uncheck"></label>
                                <span>省级</span>
                            </li>
                            <li>
                                <img src="images/city.png">
                                <input type="checkbox" id="2">
                                <label for="2" data-state="uncheck"></label>
                                <span>市级</span>
                            </li>
                            <li>
                                <img src="images/county.png">
                                <input type="checkbox" id="3">
                                <label for="3" data-state="uncheck"></label>
                                <span>县级</span>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul class="zt" style="display: none">
                    <li>
                        <ul>
                            <li>
                                <img src="images/province.png">
                                <input type="checkbox" id="1">
                                <label for="1" data-state="uncheck"></label>
                                <span>已建</span>
                            </li>
                            <li>
                                <img src="images/city.png">
                                <input type="checkbox" id="2">
                                <label for="2" data-state="uncheck"></label>
                                <span>在建</span>
                            </li>
                            <li>
                                <img src="images/county.png">
                                <input type="checkbox" id="3">
                                <label for="3" data-state="uncheck"></label>
                                <span>拟建</span>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul class="mj" style="display: none">
                    <li>
                        <ul>
                            <li>
                                <img src="images/province.png">
                                <input type="checkbox" id="1">
                                <label for="1" data-state="uncheck"></label>
                                <span>大于1000亩</span>
                            </li>
                            <li style="width: 124px;margin-right: 34px">
                                <img src="images/city.png">
                                <input type="checkbox" id="2">
                                <label for="2" data-state="uncheck"></label>
                                <span>500~1000亩</span>
                            </li>
                            <li>
                                <img src="images/county.png">
                                <input type="checkbox" id="3">
                                <label for="3" data-state="uncheck"></label>
                                <span>200~500亩</span>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <ul>
                            <li>
                                <img src="images/province.png">
                                <input type="checkbox" id="1">
                                <label for="1" data-state="uncheck"></label>
                                <span>小于200亩</span>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul class="nf" style="display: none">
                    <li>
                        <ul>
                            <li>
                                <img src="images/time1.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>2017</span>
                            </li>
                            <li>
                                <img src="images/time2.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>2016</span>
                            </li>
                            <li>
                                <img src="images/time3.png">
                                <input type="checkbox" id="6">
                                <label for="6" data-state="uncheck"></label>
                                <span>2015</span>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <ul>
                            <li>
                                <img src="images/time4.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>2014</span>
                            </li>
                            <li>
                                <img src="images/time5.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>2013</span>
                            </li>
                            <li>
                                <img src="images/time6.png">
                                <input type="checkbox" id="6">
                                <label for="6" data-state="uncheck"></label>
                                <span>2012</span>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <ul>
                            <li>
                                <img src="images/time7.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>2011</span>
                            </li>
                            <li>
                                <img src="images/time8.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>2010</span>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul class="xdny" style="display: none">
                    <li>
                        <ul>
                            <li>
                                <img src="images/province.png">
                                <input type="checkbox" id="1">
                                <label for="1" data-state="uncheck"></label>
                                <span>创建点</span>
                            </li>
                            <li>
                                <img src="images/city.png">
                                <input type="checkbox" id="2">
                                <label for="2" data-state="uncheck"></label>
                                <span>已认证</span>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul style="display: none;" class="zdcy">
                    <li>
                        <ul>
                            <li>
                                <img src="images/xm.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>畜牧类</span>
                            </li>
                            <li>
                                <img src="images/sc.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>蔬菜瓜果</span>
                            </li>
                            <li>
                                <img src="images/syj.png">
                                <input type="checkbox" id="6">
                                <label for="6" data-state="uncheck"></label>
                                <span>食用菌类</span>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <ul>
                            <li>
                                <img src="images/sg.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>水果类</span>
                            </li>
                            <li>
                                <img src="images/cy.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>茶叶类</span>
                            </li>
                            <li>
                                <img src="images/changsan.png">
                                <input type="checkbox" id="6">
                                <label for="6" data-state="uncheck"></label>
                                <span>蚕桑类</span>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <ul>
                            <li>
                                <img src="images/zyc.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>中药材类</span>
                            </li>
                            <li>
                                <img src="images/huahui.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>花卉苗木类</span>
                            </li>
                            <li>
                                <img src="images/zhumu.png">
                                <input type="checkbox" id="6">
                                <label for="6" data-state="uncheck"></label>
                                <span>竹木类</span>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <ul>
                            <li>
                                <img src="images/jingji.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>经济林类</span>
                            </li>
                            <li>
                                <img src="images/yuye.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>渔业类</span>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul style="display: none;" class="tsny">
                    <li>
                        <ul>
                            <li>
                                <img src="images/xm.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>畜牧类</span>
                            </li>
                            <li>
                                <img src="images/sc.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>蔬菜瓜果</span>
                            </li>
                            <li>
                                <img src="images/syj.png">
                                <input type="checkbox" id="6">
                                <label for="6" data-state="uncheck"></label>
                                <span>食用菌类</span>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <ul>
                            <li>
                                <img src="images/sg.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>水果类</span>
                            </li>
                            <li>
                                <img src="images/cy.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>茶叶类</span>
                            </li>
                            <li>
                                <img src="images/changsan.png">
                                <input type="checkbox" id="6">
                                <label for="6" data-state="uncheck"></label>
                                <span>蚕桑类</span>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <ul>
                            <li>
                                <img src="images/zyc.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>中药材类</span>
                            </li>
                            <li>
                                <img src="images/huahui.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>花卉苗木类</span>
                            </li>
                            <li>
                                <img src="images/zhumu.png">
                                <input type="checkbox" id="6">
                                <label for="6" data-state="uncheck"></label>
                                <span>竹木类</span>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <ul>
                            <li>
                                <img src="images/jingji.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>经济林类</span>
                            </li>
                            <li>
                                <img src="images/yuye.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>渔业类</span>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul class="cgxm" style="display: none">
                    <li>
                        <ul>
                            <li>
                                <img src="images/province.png">
                                <input type="checkbox" id="1">
                                <label for="1" data-state="uncheck"></label>
                                <span>一等田</span>
                            </li>
                            <li>
                                <img src="images/city.png">
                                <input type="checkbox" id="2">
                                <label for="2" data-state="uncheck"></label>
                                <span>二等田</span>
                            </li>
                            <li>
                                <img src="images/county.png">
                                <input type="checkbox" id="3">
                                <label for="3" data-state="uncheck"></label>
                                <span>三等田</span>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul class="bznt" style="display: none">
                    <li>
                        <ul>
                            <li>
                                <img src="images/province.png">
                                <input type="checkbox" id="1">
                                <label for="1" data-state="uncheck"></label>
                                <span>建设分布图</span>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul class="cbxm" style="display: none">
                    <li>
                        <ul>
                            <li>
                                <img src="images/province.png">
                                <input type="checkbox" id="1">
                                <label for="1" data-state="uncheck"></label>
                                <span>一等田</span>
                            </li>
                            <li>
                                <img src="images/city.png">
                                <input type="checkbox" id="2">
                                <label for="2" data-state="uncheck"></label>
                                <span>二等田</span>
                            </li>
                            <li>
                                <img src="images/county.png">
                                <input type="checkbox" id="3">
                                <label for="3" data-state="uncheck"></label>
                                <span>三等田</span>
                            </li>
                        </ul>
                    </li>
                </ul>
                <ul class="tsgc" style="display: none">
                    <li>
                        <ul>
                            <li>
                                <img src="images/time1.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>2017</span>
                            </li>
                            <li>
                                <img src="images/time2.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>2016</span>
                            </li>
                            <li>
                                <img src="images/time3.png">
                                <input type="checkbox" id="6">
                                <label for="6" data-state="uncheck"></label>
                                <span>2015</span>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <ul>
                            <li>
                                <img src="images/time4.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>2014</span>
                            </li>
                            <li>
                                <img src="images/time5.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>2013</span>
                            </li>
                            <li>
                                <img src="images/time6.png">
                                <input type="checkbox" id="6">
                                <label for="6" data-state="uncheck"></label>
                                <span>2012</span>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <ul>
                            <li>
                                <img src="images/time7.png">
                                <input type="checkbox" id="4">
                                <label for="4" data-state="uncheck"></label>
                                <span>2011</span>
                            </li>
                            <li>
                                <img src="images/time8.png">
                                <input type="checkbox" id="5">
                                <label for="5" data-state="uncheck"></label>
                                <span>2010</span>
                            </li>
                            <li>
                                <img src="images/time9.png">
                                <input type="checkbox" id="6">
                                <label for="6" data-state="uncheck"></label>
                                <span>2009</span>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <div id="cityArea" class="content" style="display: none">
            <img src="images/close.png" class="fr">
            <div class="control areaControl">


            </div>
            <div class="checks">
                <!--<ul class="gn" style="display: block">
                    <li>
                        <ul>
                            <li>
                                <img src="images/province.png">
                                <input type="checkbox" id="1">
                                <label for="1" data-state="uncheck"></label>
                                <span>省级</span>
                            </li>
                            <li>
                                <img src="images/city.png">
                                <input type="checkbox" id="2">
                                <label for="2" data-state="uncheck"></label>
                                <span>市级</span>
                            </li>
                            <li>
                                <img src="images/county.png">
                                <input type="checkbox" id="3">
                                <label for="3" data-state="uncheck"></label>
                                <span>县级</span>
                            </li>
                        </ul>
                    </li>
                </ul>-->
               
                
            </div>
        </div>
    </div>
    <div data-dojo-type="dijit/layout/BorderContainer"
         data-dojo-props="design:'headline',gutters:false"
         style="width: 100%; height: 100%; margin: 0;">
        

        <div id="map"
             data-dojo-type="dijit/layout/ContentPane"
             data-dojo-props="region:'center'">
        </div>
    </div>
    <!--切换底图-->
    <div class="MapMenu">
        <a href="javascript:void(0)" title="矢量地图" class="Mapmap"></a>
        <a href="javascript:void(0)" title="影像地图" class="Mapsatellite1"></a>

    </div>
</body>
</html>
